<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="../../assets/css/sidebar.css" />
  <link rel="stylesheet" href="../../assets/css/dashboard.css">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>
  <div class="dashboard-layout">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>SIRIN MUSEUM</h2>
        <div class="role">MANAGER</div>
      </div>

      <div class="user-profile">
        <div class="profile-avatar"><i class="fas fa-user"></i></div>
        <div class="profile-name" id="profileName">‡∏Ñ‡∏∏‡∏ì‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</div>
        <div class="profile-role" id="profileRole">‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏û‡∏¥‡∏û‡∏¥‡∏ò‡∏†‡∏±‡∏ì‡∏ë‡πå</div>
        <div class="profile-time" id="sidebarLoginTime">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö: 19:52</div>
      </div>

      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" class="nav-link active">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</a>
        </li>
        <li class="nav-item">
          <a href="export.html" class="nav-link">üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a>
        </li>
      </ul>
      <button class="logout-btn" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="content-header">
        <h1>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h1>
        <p>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°</p>
      </div>

      <div class="tab-content active">
        <!-- Statistics Cards -->
        <div class="dashboard-grid">
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background: linear-gradient(45deg, #2a8c78, #1a6b5e);">üë•</div>
              <div class="card-title">‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
            </div>
            <div class="stat-number" id="totalVisitors">94</div>
            <div class="stat-label">‡∏Ñ‡∏ô</div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background: linear-gradient(45deg, #3498db, #2980b9);">üè¢</div>
              <div class="card-title">‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
            </div>
            <div class="stat-number">8</div>
            <div class="stat-label">‡∏´‡πâ‡∏≠‡∏á</div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background: linear-gradient(45deg, #9b59b6, #8e44ad);">üì°</div>
              <div class="card-title">iBeacon ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div>
            </div>
            <div class="stat-number">45</div>
            <div class="stat-label">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background: linear-gradient(45deg, #e74c3c, #c0392b);">‚è±Ô∏è</div>
              <div class="card-title">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
            </div>
            <div class="stat-number" id="avgTime">22</div>
            <div class="stat-label">‡∏ô‡∏≤‡∏ó‡∏µ</div>
          </div>
        </div>

        <!-- Section Divider -->
        <div class="section-divider">
          <h2>üó∫Ô∏è ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏û‡∏¥‡∏û‡∏¥‡∏ò‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á</h2>
          <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß</p>
        </div>

        <!-- Museum Layout Section -->
        <div class="main-dashboard">
          <div class="museum-layout">
            <h2 class="layout-title">
              <i class="fas fa-map-marked-alt"></i>
              ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏û‡∏¥‡∏û‡∏¥‡∏ò‡∏†‡∏±‡∏ì‡∏ë‡πå
            </h2>
            <div class="museum-image-container">
              <img src="https://blog.wu.ac.th/wp-content/uploads/2022/10/S__12132359.jpg" alt="Museum Layout"
                class="museum-image">

              <!-- Room markers positioned on the museum image -->
              <div class="room-marker" data-room="1" style="left: 32%; top: 78%;">
                <div class="marker-circle capacity-green">
                  <span class="visitor-count">12</span>
                </div>
                <div class="room-label">‡∏´‡πâ‡∏≠‡∏á 1</div>
              </div>

              <div class="room-marker" data-room="2" style="left: 13%; top: 60%;">
                <div class="marker-circle capacity-green">
                  <span class="visitor-count">8</span>
                </div>
                <div class="room-label">‡∏´‡πâ‡∏≠‡∏á 2</div>
              </div>

              <div class="room-marker" data-room="3" style="left: 25%; top: 25%;">
                <div class="marker-circle capacity-yellow">
                  <span class="visitor-count">15</span>
                </div>
                <div class="room-label">‡∏´‡πâ‡∏≠‡∏á 3</div>
              </div>

              <div class="room-marker" data-room="4" style="left: 42%; top: 28%;">
                <div class="marker-circle capacity-green">
                  <span class="visitor-count">6</span>
                </div>
                <div class="room-label">‡∏´‡πâ‡∏≠‡∏á 4</div>
              </div>

              <div class="room-marker" data-room="5" style="left: 68%; top: 68%;">
                <div class="marker-circle capacity-yellow">
                  <span class="visitor-count">20</span>
                </div>
                <div class="room-label">‡∏´‡πâ‡∏≠‡∏á 5</div>
              </div>

              <div class="room-marker" data-room="6" style="left: 90%; top: 38%;">
                <div class="marker-circle capacity-green">
                  <span class="visitor-count">4</span>
                </div>
                <div class="room-label">‡∏´‡πâ‡∏≠‡∏á 6</div>
              </div>

              <div class="room-marker" data-room="7" style="left: 78%; top: 26%;">
                <div class="marker-circle capacity-red">
                  <span class="visitor-count">18</span>
                </div>
                <div class="room-label">‡∏´‡πâ‡∏≠‡∏á 7</div>
              </div>

              <div class="room-marker" data-room="8" style="left: 62%; top: 32%;">
                <div class="marker-circle capacity-yellow">
                  <span class="visitor-count">11</span>
                </div>
                <div class="room-label">‡∏´‡πâ‡∏≠‡∏á 8</div>
              </div>
            </div>

            <div class="legend">
              <div class="legend-item">
                <div class="legend-color capacity-green"></div>
                <span class="legend-text">‡∏ß‡πà‡∏≤‡∏á (&lt;60%)</span>
              </div>
              <div class="legend-item">
                <div class="legend-color capacity-yellow"></div>
                <span class="legend-text">‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏° (60-80%)</span>
              </div>
              <div class="legend-item">
                <div class="legend-color capacity-red"></div>
                <span class="legend-text">‡πÄ‡∏ï‡πá‡∏°‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏´‡∏°‡∏î (&gt;80%)</span>
              </div>
            </div>
          </div>

          <div class="details-panel">
            <div id="roomDetails" class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-mouse-pointer"></i>
              </div>
              <p style="font-size: 1.2rem; margin-bottom: 10px;">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á</p>
              <p style="font-size: 1rem;">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á</p>
            </div>

            <div class="quick-stats">
              <h4 class="quick-stats-title">
                <i class="fas fa-trophy"></i>
                ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
              </h4>
              <div id="topRooms">
                <div class="quick-stat-item">
                  <span class="quick-stat-label">#1 ‡∏´‡πâ‡∏≠‡∏á 5</span>
                  <span class="quick-stat-value">20 ‡∏Ñ‡∏ô</span>
                </div>
                <div class="quick-stat-item">
                  <span class="quick-stat-label">#2 ‡∏´‡πâ‡∏≠‡∏á 7</span>
                  <span class="quick-stat-value">18 ‡∏Ñ‡∏ô</span>
                </div>
                <div class="quick-stat-item">
                  <span class="quick-stat-label">#3 ‡∏´‡πâ‡∏≠‡∏á 3</span>
                  <span class="quick-stat-value">15 ‡∏Ñ‡∏ô</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Analytics Section -->
        <div class="analytics-section">
          <h2 class="section-title">
            <i class="fas fa-chart-bar"></i>
            ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
          </h2>

          <div class="analytics-grid">
            <!-- Demographics Chart -->
            <div class="chart-card">
              <h3 class="chart-title">
                <i class="fas fa-users"></i>
                ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏®‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏¢‡∏∏
              </h3>
              <div class="chart-container">
                <canvas id="demographicsChart"></canvas>
              </div>
            </div>

            <!-- Room Popularity Chart -->
            <div class="chart-card">
              <h3 class="chart-title">
                <i class="fas fa-star"></i>
                ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏¥‡∏¢‡∏°‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á
              </h3>
              <div class="chart-container">
                <canvas id="roomPopularityChart"></canvas>
              </div>
            </div>

            <!-- Time Spent Chart -->
            <div class="chart-card full-width">
              <h3 class="chart-title">
                <i class="fas fa-clock"></i>
                ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á (‡∏ô‡∏≤‡∏ó‡∏µ)
              </h3>
              <div class="chart-container">
                <canvas id="timeSpentChart"></canvas>
              </div>
            </div>

            <!-- Visitor Flow Timeline -->
            <div class="chart-card full-width">
              <h3 class="chart-title">
                <i class="fas fa-chart-line"></i>
                ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô
              </h3>
              <div class="chart-container">
                <canvas id="visitorFlowChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

  <script>
    // Room data
    const roomData = {
      1: { name: '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏£‡∏¥‡∏Å‡πÑ‡∏Å‡∏£‡πÄ‡∏à‡πâ‡∏≤‡∏ü‡πâ‡∏≤‡∏ô‡∏±‡∏Å‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå', visitors: 12, maxCapacity: 50, avgTime: 15 },
      2: { name: '‡∏´‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡πà‡∏á‡∏•‡πâ‡∏ô‡∏ï‡∏ô', visitors: 8, maxCapacity: 20, avgTime: 22 },
      3: { name: '‡πÄ‡∏Ç‡∏≤‡∏´‡∏•‡∏ß‡∏á‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏°‡∏≤‡∏Å‡∏°‡∏µ', visitors: 15, maxCapacity: 30, avgTime: 18 },
      4: { name: '‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏Å‡∏•‡πâ‡∏ô‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô', visitors: 6, maxCapacity: 15, avgTime: 25 },
      5: { name: '‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏•‡∏∏‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏õ‡∏≤‡∏Å‡∏û‡∏ô‡∏±‡∏á', visitors: 20, maxCapacity: 35, avgTime: 12 },
      6: { name: '‡∏ä‡∏≤‡∏¢‡∏ù‡∏±‡πà‡∏á‡∏≠‡∏∏‡∏î‡∏°‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', visitors: 4, maxCapacity: 18, avgTime: 20 },
      7: { name: '‡∏ö‡∏£‡∏¥‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏≠‡πà‡∏≤‡∏ß‡πÑ‡∏ó‡∏¢', visitors: 18, maxCapacity: 25, avgTime: 30 },
      8: { name: '‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡πÅ‡∏ó‡πâ‡πÅ‡∏Å‡πà‡∏°‡∏´‡∏≤‡∏ä‡∏ô', visitors: 11, maxCapacity: 22, avgTime: 35 }
    };

    let selectedRoom = null;

    // Get capacity color class
    function getCapacityColorClass(visitors, maxCapacity) {
      const percentage = (visitors / maxCapacity) * 100;
      if (percentage >= 80) return 'capacity-red';
      if (percentage >= 60) return 'capacity-yellow';
      return 'capacity-green';
    }

    // Get capacity status text
    function getCapacityStatus(visitors, maxCapacity) {
      const percentage = (visitors / maxCapacity) * 100;
      if (percentage >= 80) return '‡πÄ‡∏ï‡πá‡∏°‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏´‡∏°‡∏î';
      if (percentage >= 60) return '‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°';
      return '‡∏ß‡πà‡∏≤‡∏á';
    }

    // Update statistics
    function updateStats() {
      const totalVisitors = Object.values(roomData).reduce((sum, room) => sum + room.visitors, 0);
      const avgTime = Math.round(Object.values(roomData).reduce((sum, room) => sum + room.avgTime, 0) / Object.values(roomData).length);

      document.getElementById('totalVisitors').textContent = totalVisitors;
      document.getElementById('avgTime').textContent = avgTime;
    }

    // Show room details
    function showRoomDetails(roomId) {
      const room = roomData[roomId];
      const percentage = Math.round((room.visitors / room.maxCapacity) * 100);
      const colorClass = getCapacityColorClass(room.visitors, room.maxCapacity);

      const detailsHtml = `
    <div class="room-details">
      <div class="room-title-container">
        <h3 class="room-number">‡∏´‡πâ‡∏≠‡∏á ${roomId}</h3>
        <h4 class="room-name">${room.name}</h4>
      </div>
      <div class="detail-row">
        <span class="detail-label">‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</span>
        <span class="detail-value">${room.visitors}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:</span>
        <span style="font-size: 1.2rem; color: #666; font-weight: 600;">${room.maxCapacity}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span>
        <span class="status-badge ${colorClass}">${getCapacityStatus(room.visitors, room.maxCapacity)}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢:</span>
        <span style="font-size: 1.2rem; color: #666; font-weight: 600;">${room.avgTime} ‡∏ô‡∏≤‡∏ó‡∏µ</span>
      </div>
      <div class="progress-container">
        <div class="progress-header">
          <span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
          <span>${percentage}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill ${colorClass}" style="width: ${percentage}%"></div>
        </div>
      </div>
    </div>
  `;

      document.getElementById('roomDetails').innerHTML = detailsHtml;
    }

    // Hide room details
    function hideRoomDetails() {
      document.getElementById('roomDetails').innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-mouse-pointer"></i>
          </div>
          <p style="font-size: 1.2rem; margin-bottom: 10px;">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á</p>
          <p style="font-size: 1rem;">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á</p>
        </div>
      `;
    }

    // Handle room marker clicks
    document.querySelectorAll('.room-marker').forEach(marker => {
      marker.addEventListener('click', function () {
        const roomId = this.getAttribute('data-room');

        // Remove selected class from all markers
        document.querySelectorAll('.room-marker').forEach(m => m.classList.remove('selected'));

        if (selectedRoom === roomId) {
          // Deselect if clicking the same room
          selectedRoom = null;
          hideRoomDetails();
        } else {
          // Select new room
          selectedRoom = roomId;
          this.classList.add('selected');
          showRoomDetails(roomId);
        }
      });
    });

    // Simulate real-time updates
    function simulateRealTimeUpdates() {
      Object.keys(roomData).forEach(roomId => {
        const change = Math.floor(Math.random() * 5) - 2; // -2 to +2
        roomData[roomId].visitors = Math.max(0, Math.min(
          roomData[roomId].maxCapacity,
          roomData[roomId].visitors + change
        ));

        // Update marker display
        const marker = document.querySelector(`[data-room="${roomId}"]`);
        const circle = marker.querySelector('.marker-circle');
        const count = marker.querySelector('.visitor-count');

        count.textContent = roomData[roomId].visitors;
        circle.className = `marker-circle ${getCapacityColorClass(roomData[roomId].visitors, roomData[roomId].maxCapacity)}`;
      });

      updateStats();

      // Update selected room details if any
      if (selectedRoom) {
        showRoomDetails(selectedRoom);
      }

      // Update top rooms
      const sortedRooms = Object.entries(roomData)
        .sort((a, b) => b[1].visitors - a[1].visitors)
        .slice(0, 3);

      const topRoomsHtml = sortedRooms.map(([roomId, room], index) => `
        <div class="quick-stat-item">
          <span class="quick-stat-label">#${index + 1} ‡∏´‡πâ‡∏≠‡∏á ${roomId}</span>
          <span class="quick-stat-value">${room.visitors} ‡∏Ñ‡∏ô</span>
        </div>
      `).join('');

      document.getElementById('topRooms').innerHTML = topRoomsHtml;
    }

    // Simulate real-time data updates
    function updateRealtimeData() {
      const table = document.getElementById('realtimeTable');
      const now = new Date();
      const timeString = now.toLocaleTimeString('th-TH', { hour12: false });

      // Example of adding new row (you can implement actual data fetching here)
      console.log('Real-time data updated at:', timeString);
    }

    // Initialize when page loads
    document.addEventListener("DOMContentLoaded", function () {
      const firstname = localStorage.getItem("firstname");
      const lastname = localStorage.getItem("lastname");
      const role = localStorage.getItem("role");
      const loginTime = localStorage.getItem("loginTime");

      if (firstname && lastname) {
        document.getElementById("profileName").textContent = `‡∏Ñ‡∏∏‡∏ì${firstname} ${lastname}`;
      }

      if (role) {
        const roleText = {
          admin: "‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö",
          manager: "‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£",
          staff: "‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà"
        };
        document.getElementById("profileRole").textContent = roleText[role] || "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
      }

      if (loginTime) {
        document.getElementById("sidebarLoginTime").textContent = `‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö: ${loginTime}`;
      }

      updateStats();

      // Set up real-time updates every 5 seconds
      setInterval(simulateRealTimeUpdates, 5000);
      setInterval(updateRealtimeData, 30000);
    });

    // Demographics data
    const demographicsData = {
      male: { '0-14': 15, '15-25': 32, '26-40': 28, '41-60': 18, '60+': 7 },
      female: { '0-14': 18, '15-25': 45, '26-40': 35, '41-60': 22, '60+': 12 }
    };

    // Visitor flow data (hourly)
    const visitorFlowData = [5, 8, 12, 18, 25, 32, 45, 52, 48, 38, 28, 15, 8, 3];
    const timeLabels = ['9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'];

    let charts = {};

    // Initialize all charts
    function initializeCharts() {
      // Demographics Chart
      const demographicsCtx = document.getElementById('demographicsChart').getContext('2d');
      charts.demographics = new Chart(demographicsCtx, {
        type: 'bar',
        data: {
          labels: ['0-14 ‡∏õ‡∏µ', '15-25 ‡∏õ‡∏µ', '26-40 ‡∏õ‡∏µ', '41-60 ‡∏õ‡∏µ', '60+ ‡∏õ‡∏µ'],
          datasets: [{
            label: '‡∏ä‡∏≤‡∏¢',
            data: Object.values(demographicsData.male),
            backgroundColor: 'rgba(42, 140, 120, 0.8)',
            borderColor: 'rgba(42, 140, 120, 1)',
            borderWidth: 1
          }, {
            label: '‡∏´‡∏ç‡∏¥‡∏á',
            data: Object.values(demographicsData.female),
            backgroundColor: 'rgba(32, 201, 151, 0.8)',
            borderColor: 'rgba(32, 201, 151, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô'
              }
            }
          }
        }
      });

      // Room Popularity Chart
      const roomPopularityCtx = document.getElementById('roomPopularityChart').getContext('2d');
      const roomNames = Object.values(roomData).map(room => room.name.replace('‡∏´‡πâ‡∏≠‡∏á', ''));
      const roomVisitors = Object.values(roomData).map(room => room.visitors);

      charts.roomPopularity = new Chart(roomPopularityCtx, {
        type: 'doughnut',
        data: {
          labels: roomNames,
          datasets: [{
            data: roomVisitors,
            backgroundColor: [
              '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
              '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
            ],
            borderWidth: 2,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 15,
                font: {
                  size: 11
                }
              }
            }
          }
        }
      });

      // Time Spent Chart
      const timeSpentCtx = document.getElementById('timeSpentChart').getContext('2d');
      const roomLabels = Object.keys(roomData).map(id => `‡∏´‡πâ‡∏≠‡∏á ${id}`);
      const avgTimes = Object.values(roomData).map(room => room.avgTime);

      charts.timeSpent = new Chart(timeSpentCtx, {
        type: 'bar',
        data: {
          labels: roomLabels,
          datasets: [{
            label: '‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏ô‡∏≤‡∏ó‡∏µ)',
            data: avgTimes,
            backgroundColor: 'rgba(42, 140, 120, 0.8)',
            borderColor: 'rgba(42, 140, 120, 1)',
            borderWidth: 1,
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: '‡∏ô‡∏≤‡∏ó‡∏µ'
              }
            },
            x: {
              title: {
                display: true,
                text: '‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á'
              }
            }
          }
        }
      });

      // Visitor Flow Chart
      const visitorFlowCtx = document.getElementById('visitorFlowChart').getContext('2d');
      charts.visitorFlow = new Chart(visitorFlowCtx, {
        type: 'line',
        data: {
          labels: timeLabels,
          datasets: [{
            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°',
            data: visitorFlowData,
            borderColor: 'rgba(42, 140, 120, 1)',
            backgroundColor: 'rgba(42, 140, 120, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: 'rgba(42, 140, 120, 1)',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô'
              }
            },
            x: {
              title: {
                display: true,
                text: '‡πÄ‡∏ß‡∏•‡∏≤'
              }
            }
          }
        }
      });
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function () {
      // Initialize charts after a short delay to ensure canvas elements are ready
      setTimeout(() => {
        initializeCharts();
      }, 100);
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô logout
    function logout() {
      localStorage.clear();
      window.location.href = '../login.html';
    }

  </script>
</body>

</html>